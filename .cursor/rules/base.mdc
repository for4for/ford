---
alwaysApply: true
---
# Ford Bayi Otomasyonu

## ğŸš€ Port & EriÅŸim

| Servis | Port | URL |
|--------|------|-----|
| Frontend | **3084** | http://localhost:3084 |
| Backend | **8084** | http://localhost:8084 |
| PostgreSQL | **5484** | localhost:5484 |

Ã–rnek DB sorgusu:
```bash
az postgres flexible-server execute --name bayiler-postgres --admin-user bayiler_admin --admin-password 'Bayiler2026Prod!' --database-name bayiler_db --querytext "SELECT column_name FROM information_schema.columns WHERE table_name = 'campaigns_campaignrequest' ORDER BY ordinal_position;"
```

---

## ğŸ—ï¸ Mimari: Ä°ki Portal

| | Backoffice | Dealer |
|---|---|---|
| Layout | Desktop (sidebar, 800px) | Mobil (bottom nav, 640px) |
| Route | `<Resource>` (React Admin CRUD) | `<CustomRoutes>` (wizard) |
| Form | `<SimpleForm>` + RA input'larÄ± | `useState` + MUI `TextField` |
| Ortak | `useCreate`, `useUpdate`, `useNotify`, `dataProvider`, `authProvider` |

**Ortak sayfalar** (hem backoffice hem dealer'da render edilir):
- `CampaignRequestShow`, `CreativeRequestShow`, `IncentiveRequestShow`
- `CreativeRequestEdit`, `CampaignRequestReport`

### Roller

| Rol | Kod | Yetki |
|-----|-----|-------|
| Admin | `admin` | Tam CRUD |
| ModeratÃ¶r | `moderator` | GÃ¶rÃ¼ntÃ¼leme + talep dÃ¼zenleme |
| Bayi | `bayi` | Kendi taleplerini gÃ¶rÃ¼ntÃ¼leme/oluÅŸturma |

---

## ğŸ“¦ Frontend Component HaritasÄ±

```
src/components/
â”œâ”€â”€ FormFields.tsx         # Form sayfalarÄ± (Create/Edit) + Dealer form bileÅŸenleri
â”œâ”€â”€ ShowFields.tsx         # Show sayfalarÄ± (detay gÃ¶rÃ¼ntÃ¼leme)
â”œâ”€â”€ Timeline.tsx           # Zaman Ã§izelgesi
â””â”€â”€ FileUploadSection.tsx  # Dosya yÃ¼kleme
```

---

## ğŸ“ Form SayfalarÄ± (Create / Edit)

**Import:**
```tsx
import {
  FormContainer, FormCard, FormHeader, Section, Field,
  TextInputField, SelectInputField, PhoneInputField, PasswordInputField,
  inputStyles, formToolbarStyles, cancelButtonStyles, saveButtonStyles,
} from '../../components/FormFields';
```

**YapÄ±:**
```tsx
<Edit actions={false} component="div" sx={{ '& .RaEdit-main': { mt: 0 } }}>
  <FormContainer maxWidth={800}>
    <FormHeader title="BaÅŸlÄ±k" subtitle="Alt baÅŸlÄ±k" onBack={handleBack} />
    <FormCard>
      <SimpleForm toolbar={<Toolbar />} sx={{ p: 0 }}>
        <Section title="BÃ¶lÃ¼m" first />
        <Box sx={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 3 }}>
          <TextInputField source="field1" label="Alan" required />
        </Box>
      </SimpleForm>
    </FormCard>
  </FormContainer>
</Edit>
```

**Kurallar:**
- `component="div"` â†’ React Admin default Card wrapper'Ä±nÄ± kaldÄ±rÄ±r
- `maxWidth={800}` â†’ TÃ¼m sayfalar iÃ§in standart
- `FormHeader` â†’ 40x40 geri butonu, fontSize: 22, fontWeight: 600
- `useSmartBack` â†’ Navigasyon iÃ§in

---

## ğŸ‘ï¸ Show SayfalarÄ± (Detay GÃ¶rÃ¼ntÃ¼leme)

**Import:**
```tsx
import {
  ShowContainer, ShowHeader, ShowCard, SectionTitle, SummaryRow,
  MetaInfo, StatusActionCard, statusColors, RoleChip,
} from '../../components/ShowFields';
```

**YapÄ±:**
```tsx
<Show actions={false} component="div">
  <ShowContainer>
    <ShowHeader title="BaÅŸlÄ±k" subtitle="Alt" onBack={goBack}>
      <Chip label={status} />
      <Button onClick={edit}>DÃ¼zenle</Button>
    </ShowHeader>
    <ShowCard>
      <SectionTitle>BÃ¶lÃ¼m</SectionTitle>
      <SummaryRow label="Alan" value={record.field} />
    </ShowCard>
    <MetaInfo createdAt={record.created_at} updatedAt={record.updated_at} />
  </ShowContainer>
</Show>
```

**Kurallar:**
- `ShowHeader` â†’ 40x40 geri butonu, fontSize: 24, fontWeight: 700
- Header children: **status solda, dÃ¼zenle butonu saÄŸda**
- `statusColors` â†’ ShowFields.tsx'ten import

---

## â±ï¸ Timeline

```tsx
import { TimelineContainer, TimelineItem, actionToTimelineType } from '../../components/Timeline';

<TimelineContainer>
  {actions.map((action, i) => (
    <TimelineItem key={i} title={action.title} date={formatDate(action.date)}
      note={action.note} type={actionToTimelineType(action.action_type)}
      userName={action.user_name} isLast={i === actions.length - 1} />
  ))}
</TimelineContainer>
```

---

## ğŸª Dealer-Spesifik Componentler

Dealer formlarÄ± wizard: **form â†’ summary â†’ success**

```tsx
import { inputStyles, Section, FieldLabel, DealerPageHeader, DealerSummaryItem } from '../../components/FormFields';
import { useSmartBack } from '../../hooks/useSmartBack';

const smartGoBack = useSmartBack({ fallbackPath: buildUrl('/dealer/requests') });
// Form step: onBack={smartGoBack}
// Summary step: onBack={handleBackToForm}
```

- `DealerPageHeader` â†’ 36x36 geri butonu, fontSize: 16
- `DealerSummaryItem` â†’ Ã–zet label-value satÄ±rÄ± (multiline destekli)
- `FieldLabel` â†’ Form alanÄ± etiketi (required yÄ±ldÄ±zÄ±)
- **DealerAppBar** Ã¼st bar'da geri butonu yoktur

---

## ğŸ§­ Navigasyon: useSmartBack

```tsx
// Backoffice
const goBack = useSmartBack({ fallbackResource: 'campaigns/requests' });
// Dealer
const goBack = useSmartBack({ fallbackPath: buildUrl('/dealer/requests') });
```

App iÃ§i navigasyon varsa `navigate(-1)`, direkt URL ile geldiyse fallback'e gider.

---

## ğŸ¨ Renk & Spacing

| KullanÄ±m | Renk |
|----------|------|
| Arka plan | `#f9fafb` |
| Kart | `#ffffff` |
| Border | `#e5e7eb` |
| BaÅŸlÄ±k | `#111827` |
| Label | `#374151` |
| Hint/Meta | `#6b7280` |
| Hata | `#ef4444` |
| Focus | `#3b82f6` |
| Buton primary | `#1a1a2e` |
| Buton hover | `#2d2d44` |

| Eleman | DeÄŸer |
|--------|-------|
| maxWidth | `800` |
| FormContainer padding | `px: 4, py: 5` |
| FormCard padding | `p: 4` |
| Grid gap | `gap: 3` (24px) |
| Geri buton (Backoffice) | `40x40`, icon `20px` |
| Geri buton (Dealer) | `36x36`, icon `18px` |
| Input/Button border-radius | `8px` |
| Card border-radius | `12px` |

---

## ğŸ·ï¸ Badge/Chip

```tsx
import { statusColors, roleColors, getChipStyles } from '../../styles/listStyles';
<Chip label={statusColors['aktif'].label} size="small" sx={getChipStyles(statusColors['aktif'])} />;
```

Asla inline renk kullanma â†’ her zaman merkezi `statusColors` / `roleColors`

---

## âœ… Yeni Sayfa Ekleme Checklist

1. **Backoffice Create/Edit** â†’ `FormFields.tsx`, `component="div"`, `maxWidth={800}`, `useSmartBack`
2. **Backoffice Show** â†’ `ShowFields.tsx`, status solda / dÃ¼zenle saÄŸda
3. **Dealer Form** â†’ `DealerPageHeader`, `FieldLabel`, `DealerSummaryItem`, `useSmartBack({ fallbackPath })`
4. **Liste** â†’ `listStyles.ts` â†’ `statusColors` / `getChipStyles`
5. **Timeline** â†’ `Timeline.tsx`
6. **Dosya yÃ¼kleme** â†’ `FileUploadSection.tsx`
7. **Ortak sayfa ise** â†’ hem backoffice hem dealer'da test et

---

## ğŸ“Š Database Schema

### users_user
| Kolon | Tip | AÃ§Ä±klama |
|-------|-----|----------|
| `id` | BigAutoField PK | |
| `username` | VARCHAR(150) Unique | |
| `email` | EmailField | |
| `role` | VARCHAR(20) | admin, moderator, bayi |
| `dealer_id` | FK â†’ Dealer | Nullable |
| `phone` | VARCHAR(20) | |

### dealers_dealer
PK: `dealer_code` (String)

| Kolon | Tip | AÃ§Ä±klama |
|-------|-----|----------|
| `dealer_code` | VARCHAR(50) PK | TEST001 |
| `dealer_name` | VARCHAR(200) | |
| `city`, `district`, `address` | | |
| `phone`, `email`, `contact_person` | | |
| `regional_manager` | VARCHAR(200) | |
| `additional_emails` | JSONField | Array |
| `dealer_type` | VARCHAR(20) | yetkili, anlasmali, satis |
| `status` | VARCHAR(20) | aktif, pasif, askida |

### dealers_dealerbudget
Unique: `(dealer_id, year)`

| Kolon | Tip |
|-------|-----|
| `dealer_id` | FK â†’ Dealer |
| `year` | Integer |
| `total_budget` | DECIMAL(12,2) |
| `used_budget` | DECIMAL(12,2) |

### visuals_visualrequest
| Kolon | Tip | AÃ§Ä±klama |
|-------|-----|----------|
| `dealer_id` | FK â†’ Dealer | |
| `creative_work_request` | TextField | |
| `quantity_request` | Integer | |
| `work_details`, `intended_message`, `legal_text` | TextField | |
| `deadline` | DateField | |
| `reference_image` | FileField | visuals/references/ |
| `status` | VARCHAR(30) | gorsel_bekliyor, bayi_onayi_bekliyor, onay_bekliyor, onaylandi, reddedildi, tamamlandi |

Alt tablolar: `visuals_visualrequestsize` (size, quantity), `visuals_visualrequestcreative` (creative_type, description)

### incentives_incentiverequest
| Kolon | Tip | AÃ§Ä±klama |
|-------|-----|----------|
| `dealer_id` | FK â†’ Dealer | |
| `incentive_title`, `incentive_details`, `purpose` | TextField | |
| `target_audience` | TextField | |
| `incentive_amount` | DECIMAL(12,2) | |
| `proposal_document` | FileField | incentives/documents/ |
| `event_time`, `event_location`, `event_venue` | VARCHAR(200) | |
| `map_link` | URLField | |
| `performance_metrics` | TextField | |
| `reference_image` | FileField | incentives/references/ |
| `status` | VARCHAR(20) | onay_bekliyor, degerlendirme, onaylandi, reddedildi, tamamlandi |
| `approved_amount` | DECIMAL(12,2) | Nullable |

### Ä°liÅŸkiler
```
User â”€(1:1)â”€> Dealer â”€(1:N)â”€> DealerBudget
                     â”€(1:N)â”€> VisualRequest â”€(1:N)â”€> Size, Creative
                     â”€(1:N)â”€> IncentiveRequest
```

---

## ğŸ›£ï¸ API Endpoints

- `POST /api/auth/admin/token/` â€” Admin login
- `POST /api/auth/dealer/token/` â€” Dealer login
- `POST /api/token/refresh/` â€” Refresh token
- `GET /api/users/me/` â€” Current user
- CRUD: `/api/dealers/`, `/api/visualrequests/`, `/api/incentiverequests/`
- CRUD: `/api/campaigns/requests/` + `/{id}/report/` + `/{id}/change_status/`
- Docs: `/api/docs/` (Swagger), `/api/schema/` (OpenAPI)

---

## ğŸ³ Docker

```bash
docker-compose up -d              # BaÅŸlat
docker-compose down               # Durdur
docker-compose logs -f [servis]   # Log
docker-compose exec backend python manage.py migrate  # Migration
docker-compose up --build -d      # Rebuild
```

---

## ğŸ“ Proje YapÄ±sÄ±

```
ford/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ apps/ (users, dealers, visuals, incentives, campaigns)
â”‚   â”œâ”€â”€ config/
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/ (FormFields, ShowFields, Timeline, FileUploadSection)
â”‚   â”‚   â”œâ”€â”€ resources/ (dealers, users, creatives, incentives, campaigns)
â”‚   â”‚   â”œâ”€â”€ layout/ (CustomLayout, dealer/DealerLayout)
â”‚   â”‚   â”œâ”€â”€ hooks/ (useSmartBack)
â”‚   â”‚   â”œâ”€â”€ styles/ (listStyles)
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â””â”€â”€ package.json
â””â”€â”€ docker-compose.yml
```

---

## ğŸ”§ Tech Stack

**Frontend:** React 19.2, React Admin 5.12, MUI 7.3, TypeScript 5.9, Vite 7.1
**Backend:** Django 5.2, DRF 3.16, PostgreSQL, JWT (simplejwt 5.3)

---

## ğŸš€ Deployment

```bash
git push origin multi-brand
```
Railway `multi-brand` branch'ini izliyor. Push her zaman bu branch'e yapÄ±lmalÄ±dÄ±r.
